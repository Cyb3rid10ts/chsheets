pipeline {
    agent any
    options {
        //Limits the number of builds to keep to 3
        buildDiscarder(logRotator(numToKeepStr: '3'))
    }
    environment {
    }
    stages {
        stage('Build') {
            steps {
                echo 'Build phase commencing!'
                sh './myshellscript.sh'
            }
        stage('')
        }
    }
//Runs after stages above completed
  post {
        //Always run the following, regardless of what occurs
        always { 
            // Archive Unit and integration test results (Artifact), if any
          archiveArtifacts artifacts: 'dist/*.jar', fingerprint: true
        }
        //Run the following if something changed
        changed {
            mail to: "${env.EMAIL_RECIPIENTS}",
                 subject: "${JOB_NAME} - Build #${BUILD_NUMBER} - ${currentBuild.currentResult}!",
                 body: "Check console output at ${BUILD_URL} to view the results."
        }
    }
    //Starts a separate pipeline
    //Use only if specifying an agent each stage
    agent none
    stages {
        stage('Unit Tests') {
            agent {
                label 'Centos'
            }
            steps {
                sh 'cp <mydir>/<myfile>_${BUILD_NUMBER} <mydir2>/'
            }
        }
        stage('Apache testing') {
            //May run from a docker container
            agent {
                docker '<container_name>'
            }
            //Only run this stage when the Github branch is development
            //Multibranch pipeline is a project option in Jenkins
            when {
                branch 'development'
            }
            steps {
                sh ''
            }
        }
    }

}